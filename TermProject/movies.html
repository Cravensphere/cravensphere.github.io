<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Search</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.2.1/mustache.min.js"></script>
</head>
<body>
    <header>
        <h1>Movie Search</h1>
    </header>
    <main>
        <div class="search-container">
            <input type="text" id="search-query" placeholder="Enter movie title or director">
            <button id="search-button">Search</button>
            <button id="toggle-layout">Toggle Layout</button>
        </div>
        <div id="results" class="grid-container"></div>
        <div id="pagination"></div>
        <div id="movie-details"></div>
        <h2>Popular Movies and TV Shows</h2>
        <div id="collection" class="grid-container"></div>
    </main>
    <script>
        $(document).ready(function() {
            var startIndex = 1;
            var maxResults = 10;
            var totalResults = 0;
            var currentPage = 1;
            var isGridLayout = true;
            var currentResults = [];

            var movieTemplate = `
                <div class="movie-item">
                    <img src="{{thumbnail}}" alt="Movie cover" class="movie-cover">
                    <div class="movie-info">
                        <h2><a href="#" class="movie-title" data-id="{{id}}">{{title}}</a></h2>
                        <p><strong>Director:</strong> {{director}}</p>
                        <p><strong>Actors:</strong> {{actors}}</p>
                    </div>
                </div>
            `;

            var listMovieTemplate = `
                <div class="movie-item list-item">
                    <div class="movie-info">
                        <h2><a href="#" class="movie-title" data-id="{{id}}">{{title}}</a></h2>
                        <p><strong>Director:</strong> {{director}}</p>
                        <p><strong>Actors:</strong> {{actors}}</p>
                    </div>
                </div>
            `;

            function appendMovieResults(items) {
                $('#results').empty();
                items.forEach(function(item) {
                    var data = {
                        id: item.id,
                        title: item.title,
                        director: item.director || 'Unknown Director',
                        actors: item.actors ? item.actors.slice(0, 3).join(', ') : 'Unknown Actors',
                        thumbnail: item.thumbnail || 'https://via.placeholder.com/128x192?text=No+Image'
                    };
                    var template = isGridLayout ? movieTemplate : listMovieTemplate;
                    var rendered = Mustache.render(template, data);
                    $('#results').append(rendered);
                });

                // Add click event for movie titles
                $('.movie-title').click(function(event) {
                    event.preventDefault();
                    var movieId = $(this).data('id');
                    fetchMovieDetails(movieId);
                });
            }

            function fetchMovieDetails(movieId) {
                $.ajax({
                    url: 'https://api.example.com/movies/' + movieId,
                    method: 'GET',
                    success: function(response) {
                        $('#movie-details').empty();
                        if (response) {
                            var title = response.title;
                            var director = response.director || 'Unknown Director';
                            var actors = response.actors ? response.actors.join(', ') : 'Unknown Actors';
                            var description = response.description || 'No description available';
                            var thumbnail = response.thumbnail || 'https://via.placeholder.com/128x192?text=No+Image';
                            var infoLink = response.infoLink;

                            // Append the data to the movie details section
                            $('#movie-details').append('<div class="movie-detail">' +
                                '<img src="' + thumbnail + '" alt="Movie cover" class="movie-cover">' +
                                '<div class="movie-info">' +
                                '<h2>' + title + '</h2>' +
                                '<p><strong>Director:</strong> ' + director + '</p>' +
                                '<p><strong>Actors:</strong> ' + actors + '</p>' +
                                '<p><strong>Description:</strong> ' + description + '</p>' +
                                '<a href="' + infoLink + '" target="_blank">More Info</a>' +
                                '</div>' +
                                '</div>');
                        } else {
                            $('#movie-details').append('<p>No details found for this movie</p>');
                        }
                    },
                    error: function() {
                        $('#movie-details').empty();
                        $('#movie-details').append('<p>An error occurred while fetching the movie details</p>');
                    }
                });
            }

            function searchMovies(query, startIndex) {
                $.ajax({
                    url: 'https://api.example.com/movies?q=' + query + '&startIndex=' + startIndex + '&maxResults=' + maxResults,
                    method: 'GET',
                    success: function(response) {
                        if (response.items) {
                            currentResults = response.items;
                            totalResults = response.totalItems;
                            appendMovieResults(currentResults);
                            updatePagination();
                        } else {
                            $('#results').empty();
                            $('#results').append('<p>No results found</p>');
                            $('#pagination').empty();
                        }
                    },
                    error: function() {
                        $('#results').empty();
                        $('#results').append('<p>An error occurred while fetching the results</p>');
                        $('#pagination').empty();
                    }
                });
            }

            function triggerSearch() {
                var query = $('#search-query').val();
                if (query) {
                    startIndex = 1;
                    currentPage = 1;
                    searchMovies(query, startIndex);
                } else {
                    $('#results').empty();
                    $('#results').append('<p>Please enter a search query</p>');
                    $('#pagination').empty();
                }
            }

            function updatePagination() {
                $('#pagination').empty();
                var totalPages = Math.ceil(totalResults / maxResults);
                var maxPagesToShow = 5;

                if (totalPages > 1) {
                    var startPage = 1;
                    var endPage = Math.min(totalPages, maxPagesToShow);

                    for (var i = startPage; i <= endPage; i++) {
                        var button = $('<button></button>')
                            .attr('data-page', i - 1)
                            .text(i)
                            .addClass('pagination-button');
                        if (i === currentPage) {
                            button.addClass('active');
                        }
                        $('#pagination').append(button);
                    }

                    if (totalPages > maxPagesToShow) {
                        $('#pagination').append('<span>...</span>');
                        var lastButton = $('<button></button>')
                            .attr('data-page', totalPages - 1)
                            .text(totalPages)
                            .addClass('pagination-button');
                        $('#pagination').append(lastButton);
                    }

                    $('#pagination button').click(function() {
                        currentPage = parseInt($(this).attr('data-page')) + 1;
                        startIndex = $(this).attr('data-page') * maxResults;
                        searchMovies($('#search-query').val(), startIndex);
                    });
                }
            }

            $('#search-button').click(function() {
                triggerSearch();
            });

            $('#search-query').keypress(function(event) {
                if (event.which === 13) { // Enter key pressed
                    triggerSearch();
                }
            });

            $('#toggle-layout').click(function() {
                isGridLayout = !isGridLayout;
                if (isGridLayout) {
                    $('#results').removeClass('list-container').addClass('grid-container');
                    $('#collection').removeClass('list-container').addClass('grid-container');
                } else {
                    $('#results').removeClass('grid-container').addClass('list-container');
                    $('#collection').removeClass('grid-container').addClass('list-container');
                }
                appendMovieResults(currentResults);
            });

            function fetchCollection() {
                $.ajax({
                    url: 'https://api.example.com/popular',
                    method: 'GET',
                    success: function(response) {
                        if (response.items) {
                            appendMovieResults(response.items);
                        } else {
                            $('#collection').empty();
                            $('#collection').append('<p>No popular movies or TV shows found</p>');
                        }
                    },
                    error: function() {
                        $('#collection').empty();
                        $('#collection').append('<p>An error occurred while fetching the collection</p>');
                    }
                });
            }

            fetchCollection();
        });
    </script>
</body>
</html>