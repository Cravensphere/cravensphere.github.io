<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Search</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.2.1/mustache.min.js"></script>
</head>
<body>
    <header>
        <h1>Movie Search</h1>
    </header>
    <main>
        <div class="search-container">
            <input type="text" id="search-query" placeholder="Enter movie title or director">
            <button id="search-button">Search</button>
            <button id="toggle-layout">Toggle Layout</button>
            <select id="sort-options">
                <option value="releaseDate">Sort by Release Date</option>
                <option value="score">Sort by Score</option>
                <option value="alphabetical">Sort Alphabetically</option>
            </select>
        </div>
        <div id="results" class="grid-container"></div>
        <div id="pagination"></div>
        <div id="movie-details"></div>
        <h2>Popular Movies and TV Shows</h2>
        <div id="collection" class="grid-container"></div>
    </main>
    <script>
        $(document).ready(function() {
            var startIndex = 1;
            var maxResults = 10;
            var currentResults = [];
            var sortOption = 'releaseDate';

            function sortItems(items) {
                if (sortOption === 'releaseDate') {
                    items.sort((a, b) => new Date(b.release_date) - new Date(a.release_date));
                } else if (sortOption === 'score') {
                    items.sort((a, b) => b.vote_average - a.vote_average);
                } else if (sortOption === 'alphabetical') {
                    items.sort((a, b) => a.title.localeCompare(b.title));
                }
            }

            function searchMovies(query) {
                $.ajax({
                    url: 'https://api.themoviedb.org/3/search/movie?api_key=56e665fbc9c321fad4cfb7957c12244b&query=' + query,
                    method: 'GET',
                    success: function(response) {
                        if (response.results) {
                            currentResults = response.results;
                            sortItems(currentResults);
                            appendMovieResults(currentResults.slice(0, maxResults), $('#results'));
                            updatePagination();
                        } else {
                            $('#results').empty();
                            $('#results').append('<p>No results found</p>');
                        }
                    },
                    error: function() {
                        $('#results').empty();
                        $('#results').append('<p>An error occurred while fetching the results</p>');
                    }
                });
            }

            function appendMovieResults(items, container) {
                container.empty();
                items.forEach(function(item) {
                    var data = {
                        id: item.id,
                        title: item.title || item.name,
                        releaseDate: item.release_date || 'Unknown',
                        score: item.vote_average || 'N/A',
                        description: item.overview || 'No description available',
                        thumbnail: item.poster_path ? item.poster_path : '/128x192?text=No+Image',
                        infoLink: 'https://www.themoviedb.org/movie/' + item.id
                    };

                    var template = `
                        <div class="movie-item">
                            <img src="https://image.tmdb.org/t/p/w500${data.thumbnail}" alt="Movie cover" class="movie-cover">
                            <div class="movie-info">
                                <h2><a href="#" class="movie-title" data-id="${data.id}">${data.title}</a></h2>
                                <p><strong>Release Date:</strong> ${data.releaseDate}</p>
                                <p><strong>Score:</strong> ${data.score}</p>
                                <p><strong>Description:</strong> ${data.description}</p>
                                <a href="${data.infoLink}" target="_blank">More Info</a>
                            </div>
                        </div>
                    `;
                    container.append(template);
                });
            }

            function updatePagination() {
                $('#pagination').empty();
                var totalPages = Math.ceil(currentResults.length / maxResults);
                for (var i = 1; i <= totalPages; i++) {
                    var button = $('<button></button>').text(i).attr('data-page', i);
                    if (i === startIndex) {
                        button.addClass('active');
                    }
                    $('#pagination').append(button);
                }

                $('#pagination button').click(function() {
                    startIndex = parseInt($(this).attr('data-page'));
                    appendMovieResults(currentResults.slice((startIndex - 1) * maxResults, startIndex * maxResults), $('#results'));
                });
            }

            $('#search-button').click(function() {
                var query = $('#search-query').val();
                if (query) {
                    searchMovies(query);
                } else {
                    $('#results').empty();
                    $('#results').append('<p>Please enter a search query</p>');
                }
            });

            $('#sort-options').change(function() {
                sortOption = $(this).val();
                sortItems(currentResults);
                appendMovieResults(currentResults.slice((startIndex - 1) * maxResults, startIndex * maxResults), $('#results'));
            });
        });
    </script>
</body>
</html>
